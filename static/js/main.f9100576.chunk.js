(this["webpackJsonpguestbook-client"]=this["webpackJsonpguestbook-client"]||[]).push([[0],{37:function(e,t,a){e.exports=a(50)},42:function(e,t,a){},48:function(e,t,a){},50:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(25),l=a.n(c),s=(a(42),a(10)),i=a(35),o=a(34),u=a(12),m=a(14),d=a(15),v=a.n(d);function E(){var e=Object(m.a)(["\n  query GetAccessToken {\n    accessToken @client\n  }\n"]);return E=function(){return e},e}function p(){var e=Object(m.a)(["\n  query GetPosts {\n    posts {\n      id\n      title\n      contents\n      author {\n        name\n        avatar\n      }\n    }\n  }\n"]);return p=function(){return e},e}function g(){var e=Object(m.a)(["\n  mutation createPost($id: String!, $title: String, $contents: String!) {\n    createPost(id: $id, title: $title, contents: $contents) {\n      id\n      title\n      contents\n      author {\n        name\n        avatar\n      }\n    }\n  }\n"]);return g=function(){return e},e}function b(){var e=Object(m.a)(["\n  mutation login($id: String!, $name: String, $avatar: String) {\n    login(id: $id, name: $name, avatar: $avatar) {\n      name\n      avatar\n    }\n  }\n"]);return b=function(){return e},e}var f=v()(b()),h=v()(g()),N=v()(p()),y=v()(E()),j=function(){var e=Object(u.c)(N),t=e.data,a=e.loading,n=e.error,c=null;try{c=Object(u.a)().readQuery({query:N}).posts}catch(l){t&&(c=t.posts)}return a?r.a.createElement("div",{className:"has-text-centered"},r.a.createElement("div",{className:"lds-circle"},r.a.createElement("div",null))):n?(console.log(JSON.stringify(n)),r.a.createElement(r.a.Fragment,null,"Error!")):!c||Array.isArray(c)&&0===c.length?r.a.createElement("div",{className:"content has-text-centered"},"No posts yet!"):r.a.createElement(r.a.Fragment,null,c&&Object(o.a)(c).reverse().map((function(e){var t=e.id,a=e.title,n=e.contents,c=e.author,l=c.name,s=c.avatar;return r.a.createElement("article",{className:"media",key:t},r.a.createElement("figure",{className:"media-left"},r.a.createElement("p",{className:"image is-64x64"},r.a.createElement("img",{src:s,alt:"avatar"}))),r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content"},r.a.createElement("p",null,r.a.createElement("strong",null,a)," by ",r.a.createElement("strong",null,l),r.a.createElement("br",null),n))))})))},O=a(11),w=function(){var e=Object(O.b)().loginWithRedirect;return r.a.createElement(r.a.Fragment,null,r.a.createElement("article",{className:"media"},r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content has-text-centered"},r.a.createElement("p",null,r.a.createElement("strong",null,"You must be logged in to post.")),r.a.createElement("button",{className:"button is-primary is-rounded",onClick:function(){return e()}},r.a.createElement("strong",null,"Login"))))))},k=a(23),S=a.n(k),x=a(31),$=function(){var e=Object(x.a)(S.a.mark((function e(t,a,n,r,c){var l,s,i;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l={redirectUri:window.location.origin,audience:"https://caranatar-dev/access-token-test",scope:"openid email profile update:posts"},e.next=4,a(l);case 4:s=e.sent,n.writeData({data:{accessToken:s}}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0.message);case 11:i={variables:{id:r.sub,name:r.name,avatar:r.picture}},t(i),c(!1);case 14:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,a,n,r,c){return e.apply(this,arguments)}}(),T=function(e){var t=e.setIsSubmitted,a=Object(O.b)(),n=a.user,c=a.getAccessTokenWithPopup,l=Object(u.a)(),i=r.a.useState(!0),o=Object(s.a)(i,2),m=o[0],d=o[1],v=r.a.useState(""),E=Object(s.a)(v,2),p=E[0],g=E[1],b=r.a.useState(""),y=Object(s.a)(b,2),j=y[0],w=y[1],k=r.a.useState(!1),S=Object(s.a)(k,2),x=S[0],T=S[1],I=Object(u.b)(f),q=Object(s.a)(I,1)[0];r.a.useEffect((function(){$(q,c,l,n,d)}),[q,c,l,n,d]);var P=Object(u.b)(h),A=Object(s.a)(P,1)[0];return m?r.a.createElement("div",{className:"content has-text-centered"},r.a.createElement("div",{className:"lds-circle"},r.a.createElement("div",null))):r.a.createElement("article",{className:"media"},r.a.createElement("figure",{className:"media-left"},r.a.createElement("p",{className:"image is-64x64"},r.a.createElement("img",{src:n.picture,alt:"Your avatar"}))),r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content"},r.a.createElement("p",{className:"has-text-centered"},"Posting as ",r.a.createElement("strong",null,n.name))),r.a.createElement("div",{className:"field"},r.a.createElement("input",{id:"titleInput",className:"input is-info is-focused is-rounded",type:"text",placeholder:"Comment title...",value:p,onChange:function(e){return function(e){g(e.target.value)}(e)}})),r.a.createElement("hr",null),r.a.createElement("div",{className:"field"},r.a.createElement("textarea",{id:"contentsInput",className:"textarea is-info is-rounded",type:"text",placeholder:"Comment body...",value:j,onChange:function(e){return function(e){w(e.target.value),""===e.target.value.trim()?T(!1):T(!0)}(e)}})),r.a.createElement("nav",{className:"level"},r.a.createElement("div",{className:"level-right"},r.a.createElement("div",{className:"level-item"},r.a.createElement("button",{className:"button is-primary is-rounded",onClick:function(){var e={variables:{id:n.sub,title:p,contents:j},update:function(e,a){var n=a.data.createPost,r=e.readQuery({query:N}).posts;e.writeQuery({query:N,data:{posts:r.concat([n])}}),t(!0)}};A(e),g(""),w("")},disabled:!x},r.a.createElement("strong",null,"Submit")))))))},I=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("article",{className:"media"},r.a.createElement("div",{className:"media-content"},r.a.createElement("div",{className:"content has-text-centered"},r.a.createElement("div",{className:"lds-circle"},r.a.createElement("div",null))))))},q=function(e){var t=e.setIsSubmitted,a=Object(O.b)(),n=a.isLoading,c=a.isAuthenticated;return n?r.a.createElement(I,null):c?r.a.createElement(T,{setIsSubmitted:t}):r.a.createElement(w,null)},P=a(13),A=a(33),C=a(32),Q=a(36);function W(){var e=Object(m.a)(["\n  extend type Query {\n    accessToken: String!\n  }\n"]);return W=function(){return e},e}var F=v()(W()),z=a(7),B=(a(48),new A.a);B.writeData({data:{accessToken:""}});var D=new C.a({uri:"".concat("https://www.caranatar.xyz:8001","/graphql")}),J=Object(Q.a)((function(e,t){var a=t.headers,n=B.readQuery({query:y}),r=n&&n.accessToken||null;return{headers:Object(i.a)({},a,{authorization:r?"Bearer ".concat(r):""})}})),Y=new P.a({cache:B,link:J.concat(D),typeDefs:F,resolvers:{}}),G=function(){var e=r.a.useState(!1),t=Object(s.a)(e,2),a=t[0],n=t[1];return r.a.createElement(O.a,{domain:"caranatar-dev.us.auth0.com",clientId:"tPv6vSd2zVxFTK2Whfypeij3Y1QrTTWi",redirectUri:window.location.origin,audience:"https://caranatar-dev/access-token-test",scope:"update:posts"},r.a.createElement(z.a,{client:Y},r.a.createElement("div",{className:"guestbook-content"},a?null:r.a.createElement(q,{setIsSubmitted:n}),r.a.createElement(j,null))))};var L=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(G,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[37,1,2]]]);
//# sourceMappingURL=main.f9100576.chunk.js.map